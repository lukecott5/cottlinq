<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linq - Favorites</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Lexend', sans-serif;
            font-weight: 400;
            background-color: #ffffff;
            color: #333333;
        }
        .nav-link {
            transition: color 0.2s ease;
            color: #333333;
        }
        .nav-link:hover {
            color: #60a5fa;
        }
        article {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: #f9f9f9;
        }
        article:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .filter-panel {
            height: fit-content;
            background: #ffffff;
            border-radius: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            order: 2;
            position: sticky;
            top: 120px;
            z-index: 30;
        }
        .category-tag {
            display: inline-block;
            background: #e5e5e5;
            color: #333333;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            margin-left: 0.5rem;
        }
        .news-image {
            width: 150px;
            height: 100px;
            object-fit: cover;
            display: block;
            transition: transform 0.3s ease;
        }
        .news-image:hover {
            transform: scale(1.05);
        }
        .ticker-banner {
            background: #333333;
            color: #ffffff;
            padding: 0.5rem 0;
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            top: 0;
            width: 100%;
            z-index: 40;
            margin-top: 80px;
            font-size: 0.9rem;
            line-height: 1.2;
        }
        .ticker-content {
            display: inline-block;
            white-space: nowrap;
            animation: ticker-scroll 60s linear infinite;
        }
        @keyframes ticker-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        .ticker-item {
            display: inline-block;
            margin-right: 1.5rem;
        }
        @media (max-width: 768px) {
            main {
                flex-direction: column;
            }
            .filter-panel {
                order: 0;
                width: 100%;
                max-width: none;
                position: static;
            }
            #favorites {
                order: 1;
            }
            .ticker-banner {
                margin-top: 72px;
                padding: 0.4rem 0;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <nav class="bg-white py-4 shadow fixed top-0 left-0 w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <a href="index.html" class="text-4xl text-black">Linq</a>
            <div class="flex items-center space-x-6">
                <a href="index.html#news" class="nav-link">News</a>
                <a href="favorites.html" class="nav-link">Favorites</a>
                <a href="community.html" class="nav-link">Community</a>
                <a href="login.html" id="authLink" class="nav-link">Login</a>
            </div>
        </div>
    </nav>

    <div class="ticker-banner">
        <div class="ticker-content" id="tickerContent"></div>
    </div>

    <main class="max-w-7xl mx-auto pt-8 sm:px-6 lg:px-8 flex flex-wrap gap-6">
        <section id="favorites" class="flex-1 order-1 py-10">
            <h2 class="text-3xl text-gray-800 mb-6">Your Favorited Articles</h2>
            <div id="favoritesGrid" class="space-y-6"></div>
        </section>
        <aside class="filter-panel bg-white rounded-2xl shadow-xl p-6 w-80 order-2">
            <h2 class="text-2xl text-center text-gray-800 mb-6">Filter by Category</h2>
            <div id="categoryList" class="space-y-3">
                <button class="category w-full py-2 rounded-lg border border-gray-300 text-gray-800 font-medium transition-all shadow-sm hover:shadow-md" data-category="All">All</button>
                <button class="category w-full py-2 rounded-lg border border-gray-300 text-gray-800 font-medium transition-all shadow-sm hover:shadow-md" data-category="Company News">Company News</button>
                <button class="category w-full py-2 rounded-lg border border-gray-300 text-gray-800 font-medium transition-all shadow-sm hover:shadow-md" data-category="Power">Power</button>
                <button class="category w-full py-2 rounded-lg border border-gray-300 text-gray-800 font-medium transition-all shadow-sm hover:shadow-md" data-category="Crude Oil">Crude Oil</button>
                <button class="category w-full py-2 rounded-lg border border-gray-300 text-gray-800 font-medium transition-all shadow-sm hover:shadow-md" data-category="Natural Gas">Natural Gas</button>
                <button class="category w-full py-2 rounded-lg border border-gray-300 text-gray-800 font-medium transition-all shadow-sm hover:shadow-md" data-category="Petrochemicals">Petrochemicals</button>
                <button class="category w-full py-2 rounded-lg border border-gray-300 text-gray-800 font-medium transition-all shadow-sm hover:shadow-md" data-category="Renewables">Renewables</button>
                <button class="category w-full py-2 rounded-lg border border-gray-300 text-gray-800 font-medium transition-all shadow-sm hover:shadow-md" data-category="Earnings">Earnings</button>
            </div>
        </aside>
    </main>

    <footer class="bg-white text-gray-600 py-6 shadow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center">
            <p>© 2025 Linq. All rights reserved.</p>
            <div class="mt-4 md:mt-0 space-x-4">
                <a href="#terms" class="hover:text-gray-800 transition-colors" onclick="showTerms(event)">Terms of Service</a>
                <a href="#privacy" class="hover:text-gray-800 transition-colors" onclick="showPrivacy(event)">Privacy Policy</a>
                <a href="mailto:support@linq.com" class="hover:text-gray-800 transition-colors">Contact Us</a>
            </div>
        </div>
    </footer>

    <div id="termsContent" class="terms-privacy-content">
        <span class="close-btn" onclick="closeTerms()">×</span>
        <h2 class="text-2xl text-gray-800 mb-4">Terms of Service</h2>
        <p>Welcome to Linq. By accessing or using our website, you agree to comply with and be bound by the following terms and conditions. These terms govern your use of the site and any services provided.</p>
        <p class="mt-4">1. <strong>Acceptance of Terms</strong>: By using this site, you accept these terms in full. If you disagree, please do not use the site.</p>
        <p class="mt-2">2. <strong>User Conduct</strong>: You agree not to use the site for illegal or unauthorized purposes.</p>
        <p class="mt-2">3. <strong>Content Ownership</strong>: All content on this site is owned by Linq or its licensors unless otherwise stated.</p>
        <p class="mt-2">4. <strong>Limitation of Liability</strong>: We are not liable for any indirect or consequential damages arising from your use of the site.</p>
        <p class="mt-2">For the most current version, please contact us at <a href="mailto:support@linq.com">support@linq.com</a>.</p>
    </div>
    <div id="privacyContent" class="terms-privacy-content">
        <span class="close-btn" onclick="closePrivacy()">×</span>
        <h2 class="text-2xl text-gray-800 mb-4">Privacy Policy</h2>
        <p>At Linq, we are committed to protecting your privacy. This policy outlines how we collect, use, and safeguard your information.</p>
        <p class="mt-4">1. <strong>Information Collection</strong>: We collect personal information such as your name and email when you sign up or submit articles.</p>
        <p class="mt-2">2. <strong>Use of Information</strong>: Your data is used to personalize your experience and improve our services.</p>
        <p class="mt-2">3. <strong>Data Security</strong>: We implement reasonable measures to protect your information from unauthorized access.</p>
        <p class="mt-2">4. <strong>Third-Party Sharing</strong>: We do not sell or share your personal data with third parties except as required by law.</p>
        <p class="mt-2">For questions, contact us at <a href="mailto:support@linq.com">support@linq.com</a>.</p>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD_FCx8sIkrCoQMoKm5xQIvlyAmlqptETk",
            authDomain: "linq-b27a8.firebaseapp.com",
            projectId: "linq-b27a8",
            storageBucket: "linq-b27a8.appspot.com",
            messagingSenderId: "1067901051826",
            appId: "1:1067901051826:web:44452d1339cdbe2af07aab"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const FINNHUB_API_KEY = 'd0d0dlpr01qm2sk76g3gd0d0dlpr01qm2sk76g40';
        const ENERGY_STOCKS = [
            'XOM', 'CVX', 'COP', 'OXY', 'SLB', 'HAL', 'PSX', 'VLO', 'MPC', 'BKR',
            'KMI', 'WMB', 'PXD', 'EOG', 'HES', 'DVN', 'APA', 'FANG', 'CHRD', 'CTRA',
            'MTDR', 'CLR', 'SM', 'CIVI', 'HP'
        ];

        async function fetchFinnhubQuote(symbol) {
            const url = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${FINNHUB_API_KEY}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                return { price: data.c, change: data.d, percent: data.dp };
            } catch (err) {
                console.error(`Error fetching ${symbol}:`, err);
                return { price: 'N/A', change: 'N/A', percent: 'N/A' };
            }
        }

        async function updateTickerBanner() {
            const tickerContent = document.getElementById('tickerContent');
            tickerContent.innerHTML = '';
            for (const symbol of ENERGY_STOCKS) {
                const data = await fetchFinnhubQuote(symbol);
                const changeClass = data.percent !== 'N/A' ? (data.percent >= 0 ? 'positive' : 'negative') : '';
                const tickerItem = document.createElement('span');
                tickerItem.className = 'ticker-item';
                tickerItem.innerHTML = `${symbol}: $${data.price} <span class="${changeClass}">${data.percent !== 'N/A' ? `${data.percent >= 0 ? '+' : ''}${data.percent.toFixed(2)}%` : 'N/A'}</span>`;
                tickerContent.appendChild(tickerItem);
            }
            tickerContent.innerHTML = tickerContent.innerHTML.repeat(8);
        }

        async function fetchFavorites() {
            const user = auth.currentUser;
            if (!user) {
                window.location.href = 'login.html';
                return [];
            }

            const userRef = db.collection('users').doc(user.uid);
            try {
                const doc = await userRef.get();
                return doc.exists && doc.data().favorites ? doc.data().favorites.articles || [] : [];
            } catch (error) {
                console.error('Error fetching favorites:', error);
                return [];
            }
        }

        function renderFavorites(articles, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            if (articles.length === 0) {
                container.innerHTML = '<p class="text-gray-600">No favorited articles yet.</p>';
                return;
            }
            articles.forEach(article => {
                const articleElement = document.createElement('article');
                articleElement.className = 'p-6 rounded-xl bg-gray-50';
                articleElement.innerHTML = `
                    <div class="flex gap-4">
                        ${article.image ? `<img src="${article.image}" alt="${article.title}" class="news-image rounded-lg">` : ''}
                        <div class="flex-1">
                            <h3 class="text-xl text-gray-800 font-medium">
                                <a href="${article.link}" target="_blank" class="hover:text-blue-600 transition-colors">${article.title}</a>
                            </h3>
                            <p class="text-gray-600 mt-2">${article.date} • ${article.source} <span class="category-tag">${article.category || 'Uncategorized'}</span></p>
                        </div>
                    </div>
                `;
                container.appendChild(articleElement);
            });
        }

        function filterFavorites(articles, category) {
            const filtered = category === 'All'
                ? articles
                : articles.filter(article => article.category === category);
            renderFavorites(filtered, 'favoritesGrid');
        }

        function showTerms(event) {
            event.preventDefault();
            document.getElementById('termsContent').style.display = 'block';
        }

        function closeTerms() {
            document.getElementById('termsContent').style.display = 'none';
        }

        function showPrivacy(event) {
            event.preventDefault();
            document.getElementById('privacyContent').style.display = 'block';
        }

        function closePrivacy() {
            document.getElementById('privacyContent').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            auth.onAuthStateChanged(async user => {
                const authLink = document.getElementById('authLink');
                if (user) {
                    authLink.textContent = 'Profile';
                    authLink.href = 'profile.html';
                    const favorites = await fetchFavorites();
                    renderFavorites(favorites, 'favoritesGrid');
                } else {
                    authLink.textContent = 'Login';
                    authLink.href = 'login.html';
                    window.location.href = 'login.html';
                }
            });

            updateTickerBanner();

            document.getElementById('categoryList').addEventListener('click', async (e) => {
                if (e.target.classList.contains('category')) {
                    document.querySelectorAll('.category').forEach(btn => btn.classList.remove('bg-gray-200'));
                    e.target.classList.add('bg-gray-200');
                    const favorites = await fetchFavorites();
                    filterFavorites(favorites, e.target.dataset.category);
                }
            });
        });
    </script>
</body>
</html>
