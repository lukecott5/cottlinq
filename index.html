<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linq News</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Lexend', sans-serif;
            font-weight: 400;
            background-color: #ffffff;
            color: #333333;
        }
        strong {
            font-weight: inherit;
        }
        .terms-privacy-content {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            z-index: 60;
            color: #333333;
        }
        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666666;
            transition: color 0.2s ease;
        }
        .close-btn:hover {
            color: #000000;
        }
        article {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: #f9f9f9;
        }
        article:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .nav-link {
            transition: color 0.2s ease;
            color: #333333;
        }
        .nav-link:hover {
            color: #60a5fa;
        }
        .favorite-btn {
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .favorite-btn:hover {
            color: #f59e0b;
            transform: scale(1.2);
        }
        .favorited {
            color: #f59e0b;
        }
        .sidebar {
            position: sticky;
            top: 2rem;
            height: fit-content;
            background: #f9f9f9;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .sidebar label:hover {
            background: #e5e5e5;
        }
        .category-tag {
            display: inline-block;
            background: #e5e5e5;
            color: #333333;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            margin-left: 0.5rem;
        }
        .news-image {
            width: 150px;
            height: 100px;
            object-fit: cover;
            display: block;
            transition: transform 0.3s ease;
        }
        .news-image:hover {
            transform: scale(1.05);
        }
        .tagline {
            text-align: center;
            font-size: 2.5rem;
        }
        .tagline .highlight {
            color: #60a5fa;
        }
        .market-section {
            background: #ffffff;
            padding: 1.5rem;
            margin-top: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .market-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .market-tab {
            cursor: pointer;
            color: #666666;
            padding: 0.5rem 1rem;
            transition: color 0.2s ease;
        }
        .market-tab:hover, .market-tab.active {
            color: #000000;
        }
        .market-content {
            display: none;
        }
        .market-content.active {
            display: block;
        }
        .market-table {
            width: 100%;
            border-collapse: collapse;
        }
        .market-table th, .market-table td {
            padding: 0.75rem;
            text-align: right;
            border-bottom: 1px solid #e5e5e5;
        }
        .market-table th:first-child, .market-table td:first-child {
            text-align: left;
            color: #333333;
        }
        .positive {
            color: #10b981;
        }
        .negative {
            color: #ef4444;
        }
        .ticker-banner {
            background: #333333;
            color: #ffffff;
            padding: 0.5rem 0;
            overflow: hidden;
            white-space: nowrap;
        }
        .ticker-content {
            display: inline-block;
        }
        .ticker-item {
            display: inline-block;
            margin-right: 2rem;
        }
        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(var(--ticker-width)); }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="bg-white py-4 shadow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <a href="#" class="text-4xl text-black">Linq News</a>
            <div class="flex items-center space-x-6">
                <a href="#news" class="nav-link">News</a>
                <a href="#favorites" id="favoritesTab" class="nav-link">Favorites</a>
                <a href="login.html" id="authBtn" class="nav-link">Login / Sign Up</a>
                <button id="logoutBtn" class="nav-link hidden" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Stock Ticker Banner -->
    <div class="ticker-banner">
        <div class="ticker-content" id="tickerContent">
            <!-- Ticker items will be populated dynamically -->
        </div>
    </div>

    <!-- Tagline Section -->
    <div class="tagline text-4xl text-gray-800 py-10">
        The <span class="highlight">Linq</span> to your Energy News
    </div>

    <!-- Market Updates Section -->
    <section class="market-section max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="market-tabs">
            <div id="tabCommodities" class="market-tab active">Commodities</div>
            <div id="tabUS" class="market-tab">Equities</div>
            <div id="tabTreasuries" class="market-tab">Treasuries</div>
        </div>
        <div id="marketCommoditiesContent" class="market-content active">
            <table class="market-table">
                <tr>
                    <th>WTI Crude</th>
                    <td>58.29</td>
                    <td>-0.95</td>
                    <td class="negative">-1.60%</td>
                </tr>
                <tr>
                    <th>Brent Crude</th>
                    <td>62.45</td>
                    <td>-0.75</td>
                    <td class="negative">-1.19%</td>
                </tr>
                <tr>
                    <th>RBOB Gasoline</th>
                    <td>1.82</td>
                    <td>-0.03</td>
                    <td class="negative">-1.62%</td>
                </tr>
                <tr>
                    <th>Natural Gas</th>
                    <td>3.15</td>
                    <td>0.05</td>
                    <td class="positive">+1.61%</td>
                </tr>
                <tr>
                    <th>Heating Oil</th>
                    <td>1.95</td>
                    <td>-0.02</td>
                    <td class="negative">-1.01%</td>
                </tr>
            </table>
        </div>
        <div id="marketUSContent" class="market-content">
            <table class="market-table">
                <tr>
                    <th>Dow Jones</th>
                    <td>41,317.43</td>
                    <td>564.47</td>
                    <td class="positive">+1.39%</td>
                </tr>
                <tr>
                    <th>S&P 500</th>
                    <td>5,686.68</td>
                    <td>82.54</td>
                    <td class="positive">+1.47%</td>
                </tr>
                <tr>
                    <th>Nasdaq</th>
                    <td>17,977.73</td>
                    <td>266.99</td>
                    <td class="positive">+1.51%</td>
                </tr>
            </table>
        </div>
        <div id="marketTreasuriesContent" class="market-content">
            <table class="market-table">
                <tr>
                    <th>10-Year Treasury Yield</th>
                    <td>4.40%</td>
                    <td>0.02</td>
                    <td class="positive">+0.00%</td>
                </tr>
                <tr>
                    <th>2-Year Treasury Yield</th>
                    <td>4.15%</td>
                    <td>0.01</td>
                    <td class="positive">+0.00%</td>
                </tr>
                <tr>
                    <th>30-Year Treasury Yield</th>
                    <td>4.65%</td>
                    <td>0.03</td>
                    <td class="positive">+0.00%</td>
                </tr>
            </table>
        </div>
    </section>

    <!-- Terms and Privacy Sections -->
    <div id="termsContent" class="terms-privacy-content">
        <span class="close-btn" onclick="closeTerms()">Ã—</span>
        <h2 class="text-2xl text-gray-800 mb-4">Terms of Service</h2>
        <p>Welcome to Linq News. By accessing or using our website, you agree to comply with and be bound by the following terms and conditions. These terms govern your use of the site and any services provided.</p>
        <p class="mt-4">1. <strong>Acceptance of Terms</strong>: By using this site, you accept these terms in full. If you disagree, please do not use the site.</p>
        <p class="mt-2">2. <strong>User Conduct</strong>: You agree not to use the site for illegal or unauthorized purposes.</p>
        <p class="mt-2">3. <strong>Content Ownership</strong>: All content on this site is owned by Linq News or its licensors unless otherwise stated.</p>
        <p class="mt-2">4. <strong>Limitation of Liability</strong>: We are not liable for any indirect or consequential damages arising from your use of the site.</p>
        <p class="mt-2">For the most current version, please contact us at support@linqnews.com.</p>
    </div>
    <div id="privacyContent" class="terms-privacy-content">
        <span class="close-btn" onclick="closePrivacy()">Ã—</span>
        <h2 class="text-2xl text-gray-800 mb-4">Privacy Policy</h2>
        <p>At Linq News, we are committed to protecting your privacy. This policy outlines how we collect, use, and safeguard your information.</p>
        <p class="mt-4">1. <strong>Information Collection</strong>: We collect personal information such as your name and email when you sign up or submit articles.</p>
        <p class="mt-2">2. <strong>Use of Information</strong>: Your data is used to personalize your experience and improve our services.</p>
        <p class="mt-2">3. <strong>Data Security</strong>: We implement reasonable measures to protect your information from unauthorized access.</p>
        <p class="mt-2">4. <strong>Third-Party Sharing</strong>: We do not sell or share your personal data with third parties except as required by law.</p>
        <p class="mt-2">For questions, contact us at privacy@linqnews.com.</p>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-10 sm:px-6 lg:px-8">
        <div class="flex flex-col lg:flex-row lg:space-x-8">
            <!-- News Section -->
            <section id="news" class="flex-1">
                <h2 class="text-3xl text-gray-800 mb-6">Latest News</h2>
                <div id="newsGrid" class="space-y-6"></div>
            </section>

            <!-- Right Sidebar Filter Panel -->
            <aside class="sidebar lg:w-72 mt-10 lg:mt-0">
                <h3 class="text-xl text-gray-800 mb-4">Filter by Category</h3>
                <div class="space-y-3">
                    <label class="flex items-center p-2 rounded-lg transition-colors">
                        <input type="checkbox" class="category-checkbox h-5 w-5 text-blue-500 rounded focus:ring-blue-400" value="Crude Oil">
                        <span class="ml-3 text-gray-800 text-lg">Crude Oil</span>
                    </label>
                    <label class="flex items-center p-2 rounded-lg transition-colors">
                        <input type="checkbox" class="category-checkbox h-5 w-5 text-blue-500 rounded focus:ring-blue-400" value="Natural Gas">
                        <span class="ml-3 text-gray-800 text-lg">Natural Gas</span>
                    </label>
                    <label class="flex items-center p-2 rounded-lg transition-colors">
                        <input type="checkbox" class="category-checkbox h-5 w-5 text-blue-500 rounded focus:ring-blue-400" value="Petrochemicals">
                        <span class="ml-3 text-gray-800 text-lg">Petrochemicals</span>
                    </label>
                    <label class="flex items-center p-2 rounded-lg transition-colors">
                        <input type="checkbox" class="category-checkbox h-5 w-5 text-blue-500 rounded focus:ring-blue-400" value="Power">
                        <span class="ml-3 text-gray-800 text-lg">Power</span>
                    </label>
                    <label class="flex items-center p-2 rounded-lg transition-colors">
                        <input type="checkbox" class="category-checkbox h-5 w-5 text-blue-500 rounded focus:ring-blue-400" value="Renewables">
                        <span class="ml-3 text-gray-800 text-lg">Renewables</span>
                    </label>
                    <label class="flex items-center p-2 rounded-lg transition-colors">
                        <input type="checkbox" class="category-checkbox h-5 w-5 text-blue-500 rounded focus:ring-blue-400" value="Company News">
                        <span class="ml-3 text-gray-800 text-lg">Company News</span>
                    </label>
                    <label class="flex items-center p-2 rounded-lg transition-colors">
                        <input type="checkbox" class="category-checkbox h-5 w-5 text-blue-500 rounded focus:ring-blue-400" value="Earnings">
                        <span class="ml-3 text-gray-800 text-lg">Earnings</span>
                    </label>
                </div>
            </aside>
        </div>

        <!-- Favorites Section -->
        <section id="favorites" class="hidden py-10">
            <h2 class="text-3xl text-gray-800 mb-6">Your Favorited Articles</h2>
            <div id="favoritesGrid" class="space-y-6"></div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-white text-gray-600 py-6 shadow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center">
            <p>Â© 2025 Linq News. All rights reserved.</p>
            <div class="mt-4 md:mt-0 space-x-4">
                <a href="#" class="hover:text-gray-800 transition-colors" onclick="showTerms(event)">Terms of Service</a>
                <a href="#" class="hover:text-gray-800 transition-colors" onclick="showPrivacy(event)">Privacy Policy</a>
                <a href="#" class="hover:text-gray-800 transition-colors">Contact Us</a>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA4PakmXmHIdpa2PIlyGorUFcrtGHYPerU",
            authDomain: "linq-news.firebaseapp.com",
            projectId: "linq-news",
            storageBucket: "linq-news.firebasestorage.app",
            messagingSenderId: "341531763593",
            appId: "1:341531763593:web:38909f7037e4ed2d4c7758",
            measurementId: "G-PW63LYHPFC"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);

        // Initialize Firebase Authentication
        const auth = firebase.auth();

        // Polygon.io API key
        const POLYGON_API_KEY = 'tnX_5sLwVqeqDEzzWf1PzLD3Ac4beaP3';

        // NewsAPI key (replace with your own key)
        const NEWS_API_KEY = 'YOUR_NEWSAPI_KEY'; // Sign up at https://newsapi.org/ to get your key

        // List of stock tickers to display in the ticker banner
        const STOCK_TICKERS = ['XOM', 'CVX', 'COP', 'OXY', 'SLB'];

        // Function to fetch live stock data from Polygon.io
        async function fetchLiveStockData() {
            const tickerString = STOCK_TICKERS.join(',');
            const url = `https://api.polygon.io/v2/snapshot/locale/us/markets/stocks/tickers?tickers=${tickerString}&apiKey=${POLYGON_API_KEY}`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                console.log('Polygon.io API Response:', data);
                if (data.status !== 'OK' || !data.tickers) {
                    throw new Error('Invalid API response structure');
                }
                return data.tickers;
            } catch (error) {
                console.error('Error fetching live stock data:', error);
                return STOCK_TICKERS.map(ticker => ({
                    ticker: ticker,
                    lastTrade: { p: 'N/A' },
                    day: { c: 0 },
                    prevDay: { c: 0 }
                }));
            }
        }

        // Function to format the percentage change
        function formatChangePercent(currentPrice, prevClose) {
            if (!prevClose || prevClose === 0 || currentPrice === 'N/A') return 'N/A';
            const changePercent = ((currentPrice - prevClose) / prevClose * 100).toFixed(2);
            return changePercent >= 0 ? `+${changePercent}%` : `${changePercent}%`;
        }

        // Function to update the ticker banner with live data
        async function updateTickerBanner() {
            const tickerContent = document.getElementById('tickerContent');
            const liveData = await fetchLiveStockData();
            
            tickerContent.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                liveData.forEach(stock => {
                    const price = stock.lastTrade?.p || 'N/A';
                    const changePercent = formatChangePercent(stock.day?.c || price, stock.prevDay?.c || price);
                    const changeClass = changePercent.startsWith('+') ? 'positive' : (changePercent === 'N/A' ? '' : 'negative');
                    
                    const tickerItem = document.createElement('span');
                    tickerItem.className = 'ticker-item';
                    tickerItem.innerHTML = `${stock.ticker}: $${price} <span class="${changeClass}">${changePercent}</span>`;
                    tickerContent.appendChild(tickerItem);
                });
            }

            const tickerWidth = tickerContent.scrollWidth;
            tickerContent.style.setProperty('--ticker-width', `-${tickerWidth}px`);
            tickerContent.style.animation = `ticker 80s linear infinite`;
        }

        window.addEventListener('load', updateTickerBanner);

        // Function to determine article category based on title or content
        function determineCategory(article) {
            const title = article.title.toLowerCase();
            const description = article.description ? article.description.toLowerCase() : '';

            if (title.includes('crude') || description.includes('crude') || title.includes('oil price') || description.includes('oil price')) {
                return 'Crude Oil';
            } else if (title.includes('natural gas') || description.includes('natural gas') || title.includes('lng') || description.includes('lng')) {
                return 'Natural Gas';
            } else if (title.includes('petrochemical') || description.includes('petrochemical') || title.includes('chemical') || description.includes('chemical')) {
                return 'Petrochemicals';
            } else if (title.includes('power') || description.includes('power') || title.includes('electricity') || description.includes('electricity') || title.includes('grid') || description.includes('grid')) {
                return 'Power';
            } else if (title.includes('renewable') || description.includes('renewable') || title.includes('solar') || description.includes('solar') || title.includes('wind') || description.includes('wind')) {
                return 'Renewables';
            } else if (title.includes('earnings') || description.includes('earnings') || title.includes('profit') || description.includes('profit') || title.includes('quarterly') || description.includes('quarterly')) {
                return 'Earnings';
            } else if (title.includes('company') || description.includes('company') || title.includes('merger') || description.includes('merger') || title.includes('acquisition') || description.includes('acquisition')) {
                return 'Company News';
            }
            return 'Company News'; // Default category
        }

        // Function to fetch news articles from NewsAPI
        async function fetchNewsArticles() {
            const query = 'energy OR crude oil OR natural gas OR petrochemical OR power OR renewables OR "energy company" OR "energy earnings"';
            const url = `https://newsapi.org/v2/everything?q=${encodeURIComponent(query)}&language=en&sortBy=publishedAt&apiKey=${NEWS_API_KEY}`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                console.log('NewsAPI Response:', data);
                if (data.status !== 'ok' || !data.articles) {
                    throw new Error('Invalid API response structure');
                }

                // Map API articles to our format
                return data.articles.slice(0, 21).map((article, index) => ({
                    id: index + 1,
                    category: determineCategory(article),
                    title: article.title || 'Untitled Article',
                    date: new Date(article.publishedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),
                    source: article.source.name || 'Unknown Source',
                    link: article.url || '#',
                    image: article.urlToImage || 'https://via.placeholder.com/150x100?text=No+Image'
                }));
            } catch (error) {
                console.error('Error fetching news articles:', error);
                // Fallback to mock data if API fails
                return [
                    { id: 1, category: 'Crude Oil', title: 'Oil Prices Surge Amid Supply Concerns', date: 'May 3, 2025', source: 'Reuters', link: 'https://example.com/article-1', image: 'https://via.placeholder.com/150x100?text=Crude+Oil' },
                    { id: 2, category: 'Natural Gas', title: 'Natural Gas Prices Soar in Europe', date: 'May 3, 2025', source: 'Seeking Alpha', link: 'https://example.com/article-4', image: 'https://via.placeholder.com/150x100?text=Natural+Gas' }
                ];
            }
        }

        // Terms and Privacy Sections
        const termsContent = document.getElementById('termsContent');
        const privacyContent = document.getElementById('privacyContent');

        function showTerms(event) {
            event.preventDefault();
            termsContent.style.display = 'block';
        }

        function closeTerms() {
            termsContent.style.display = 'none';
        }

        function showPrivacy(event) {
            event.preventDefault();
            privacyContent.style.display = 'block';
        }

        function closePrivacy() {
            privacyContent.style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target === termsContent) {
                closeTerms();
            }
            if (event.target === privacyContent) {
                closePrivacy();
            }
        };

        // User Authentication State
        let currentUser = JSON.parse(localStorage.getItem('user')) || null;
        const authBtn = document.getElementById('authBtn');
        const logoutBtn = document.getElementById('logoutBtn');

        function updateUIForUser() {
            if (currentUser) {
                authBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
            } else {
                authBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
            }
        }

        function handleLogout() {
            auth.signOut().then(() => {
                localStorage.removeItem('user');
                currentUser = null;
                updateUIForUser();
                showNewsSection();
                window.location.href = 'login.html';
            }).catch(error => {
                alert('Error signing out: ' + error.message);
            });
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = { email: user.email, uid: user.uid, favorites: currentUser?.favorites || [] };
                localStorage.setItem('user', JSON.stringify(currentUser));
            } else {
                currentUser = null;
                localStorage.removeItem('user');
            }
            updateUIForUser();
        });

        updateUIForUser();

        // Display articles
        const newsGrid = document.getElementById('newsGrid');
        let displayedArticles = [];

        async function loadArticles() {
            displayedArticles = await fetchNewsArticles();
            displayArticles(displayedArticles);
        }

        function displayArticles(articles) {
            newsGrid.innerHTML = '';
            articles.forEach(article => {
                const articleElement = document.createElement('article');
                articleElement.className = 'rounded-lg shadow-lg flex flex-col sm:flex-row items-start sm:items-center overflow-hidden';
                articleElement.setAttribute('data-category', article.category);
                articleElement.innerHTML = `
                    <img src="${article.image}" alt="${article.category}" class="news-image m-4 sm:m-0 sm:mr-4" loading="lazy">
                    <div class="p-4 flex-1">
                        <div class="flex justify-between items-start">
                            <div>
                                <h2 class="text-lg text-gray-800 hover:text-blue-400">
                                    <a href="${article.link}" target="_blank">${article.title}</a>
                                </h2>
                                <p class="text-gray-600 text-sm mt-1">${article.date} â€¢ ${article.source} <span class="category-tag">${article.category}</span></p>
                            </div>
                            <button class="favorite-btn mt-1" onclick="toggleFavorite(${article.id})">â˜†</button>
                        </div>
                    </div>
                `;
                newsGrid.appendChild(articleElement);
            });

            if (currentUser && currentUser.favorites) {
                currentUser.favorites.forEach(id => {
                    const button = document.querySelector(`button[onclick="toggleFavorite(${id})"]`);
                    if (button) button.classList.add('favorited');
                });
            }
        }

        // Load articles when the page loads
        window.addEventListener('load', loadArticles);

        // Category filtering with checkboxes
        const checkboxes = document.querySelectorAll('.category-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const selectedCategories = Array.from(checkboxes)
                    .filter(cb => cb.checked)
                    .map(cb => cb.value);

                if (selectedCategories.length === 0) {
                    displayArticles(displayedArticles);
                } else {
                    const filteredArticles = displayedArticles.filter(article => 
                        selectedCategories.includes(article.category)
                    );
                    displayArticles(filteredArticles);
                }
            });
        });

        // Favorites handling
        let favorites = currentUser ? currentUser.favorites : [];
        const newsSection = document.getElementById('news');
        const favoritesSection = document.getElementById('favorites');
        const favoritesGrid = document.getElementById('favoritesGrid');

        function toggleFavorite(articleId) {
            if (!currentUser) {
                alert('Please log in to favorite articles.');
                window.location.href = 'login.html';
                return;
            }
            const index = favorites.indexOf(articleId);
            const button = document.querySelector(`button[onclick="toggleFavorite(${articleId})"]`);
            if (index === -1) {
                favorites.push(articleId);
                button.classList.add('favorited');
            } else {
                favorites.splice(index, 1);
                button.classList.remove('favorited');
            }
            currentUser.favorites = favorites;
            localStorage.setItem('user', JSON.stringify(currentUser));
            updateFavoritesSection();
        }

        function updateFavoritesSection() {
            favoritesGrid.innerHTML = '';
            const favoritedArticles = displayedArticles.filter(article => favorites.includes(article.id));
            favoritedArticles.forEach(article => {
                const articleElement = document.createElement('article');
                articleElement.className = 'rounded-lg shadow-lg flex flex-col sm:flex-row items-start sm:items-center overflow-hidden';
                articleElement.setAttribute('data-category', article.category);
                articleElement.innerHTML = `
                    <img src="${article.image}" alt="${article.category}" class="news-image m-4 sm:m-0 sm:mr-4" loading="lazy">
                    <div class="p-4 flex-1">
                        <div class="flex justify-between items-start">
                            <div>
                                <h2 class="text-lg text-gray-800 hover:text-blue-400">
                                    <a href="${article.link}" target="_blank">${article.title}</a>
                                </h2>
                                <p class="text-gray-600 text-sm mt-1">${article.date} â€¢ ${article.source} <span class="category-tag">${article.category}</span></p>
                            </div>
                            <button class="favorite-btn mt-1 favorited" onclick="toggleFavorite(${article.id})">â˜†</button>
                        </div>
                    </div>
                `;
                favoritesGrid.appendChild(articleElement);
            });
        }

        document.getElementById('favoritesTab').addEventListener('click', () => {
            newsSection.classList.add('hidden');
            favoritesSection.classList.remove('hidden');
            updateFavoritesSection();
        });

        document.querySelector('a[href="#news"]').addEventListener('click', () => {
            showNewsSection();
        });

        function showNewsSection() {
            newsSection.classList.remove('hidden');
            favoritesSection.classList.add('hidden');
        }

        document.querySelectorAll('img').forEach(img => {
            img.onerror = function() {
                this.src = 'https://via.placeholder.com/150x100?text=Image+Not+Found';
                this.alt = 'Image Not Found';
            };
        });

        const marketTabs = document.querySelectorAll('.market-tab');
        const marketContents = document.querySelectorAll('.market-content');

        marketTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                marketTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                marketContents.forEach(content => content.classList.remove('active'));
                const contentId = `market${tab.id.replace('tab', '')}Content`;
                document.getElementById(contentId).classList.add('active');
            });
        });
    </script>
</body>
</html>
